{% extends 'base.html' %}

{% block title %}Add a food{% endblock %}

{% block content %}
<section>
    <h1>Add a food from your own history</h1>
    <form id="db-search">
        <input type="text" id="db_search_term" 
            placeholder="Search your foods" 
            size="100" required />
        <input type="submit">
    </form>
</section>

<section id="display-db-search">Database search results go here</section>

<section id="food-search">
    <h1>Add a food from a database</h1>

    <form id="search-food">
        <input type="text" id="search_term" 
            placeholder="Search our database" size="100" required />
        <input type="submit" />
    </form>
</section>

<section id="display-search">Nutrionix search results go here</section>

{% endblock %}

{% block js %}

    <script>
        "use strict";


      $('#search-food').on('submit', (evt) => {
        evt.preventDefault();

        const searchTerm = $('#search_term').val();

        $.get(`/food_search/${searchTerm}`, (res) => {
            
            const foods = res["foods"]
            const container = $('#display-search');
            container.empty()

            for (const food of foods) {
                container.append(`
                    <div class='food'>
                        <p>Brand: ${food.brand_name}</p>
                        <p>Name: ${food.brand_name_item_name}</p>
                        <img src='${food.photo.thumb}' /><br>
                        <p>NIX ID: ${food.nix_item_id}</p>
                        <a href='/add_to_db/${food.nix_item_id}'>This one!</a>
                    </div>`
                );
            };

        });
      });

    $('#db-search').on('submit', (evt) => {
        evt.preventDefault();

        const dbSearchTerm = $('#db_search_term').val();

        $.get(`/db_food_search/${dbSearchTerm}`, (res) => {
            
            const foods = res["foods"]
            const container = $('#display-db-search');
            container.empty()

            ;debugger

            if (foods.length === 0) {
                container.append('<br><i>No foods found</i>');
            }

            else {

                container.append('<ul>');

                for (const food of foods) {
                    container.append(`
                        <li>${food.food} (${food.brand})
                        </li>`
                    );

                container.append('</ul');
                };
            }

        });
      });

    </script>

{% endblock %}