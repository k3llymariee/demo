{% extends 'base.html' %}

{% block title %}Add a food{% endblock %}

{% block content %}
<section>
    <h1>Add a food from your own history</h1>
    <form id="db-search">
        <input type="text" id="db_search_term" 
            placeholder="Search your foods" 
            size="100" required />
        <input type="submit">
    </form>
</section>

<section id="display-db-search">
    <br><span class="temporary">Database search results go here</span>
</section>

<section id="food-search">
    <h1>Add a food from a database</h1>

    <form id="search-food">
        <input type="text" id="search_term" 
            placeholder="Search our database" size="100" required />
        <input type="submit" />
    </form>
</section>

<section id="display-search">
    <br><span class="temporary">Nutritionix search results go here</span>
</section>

{% endblock %}

{% block js %}

    <script>
        "use strict";

        function getFoodData() {
        // Get the up to date food data from DB for the signed in user

        $.get('/user_foods.json', insertFoodData);
        }

        const insertFoodData = (res) => {
        // Once the data has been provided by the server,
        // insert it into the page as an HTML string.

        const listOfFoods = res.foods;

        const container = $('#display-db-search');

        container.empty()
        container.append('<p>Recently eaten foods:</p>')

        for (const currentFood of listOfFoods) {

        container.append(`
            <div>
            <ul>
                <li>${currentFood.name} (${currentFood.brand})</li>
            </ul></div>`
        );
        }
        }



      $('#search-food').on('submit', (evt) => {
        evt.preventDefault();

        const searchTerm = $('#search_term').val();

        $.get(`/food_search/${searchTerm}`, (res) => {
            
            const foods = res["foods"]
            const container = $('#display-search');
            container.empty()
            container.append('<p>Nutritionix food resutls</p>')

            for (const food of foods) {
                container.append(`
                    <div class='food'>
                        <p>Brand: ${food.brand_name}</p>
                        <p>Name: ${food.brand_name_item_name}</p>
                        <img src='${food.photo.thumb}' /><br>
                        <p>NIX ID: ${food.nix_item_id}</p>
                        <a href='/add_to_db/${food.nix_item_id}'>This one!</a>
                    </div>`
                );
            };

        });
      });

    $('#db-search').on('submit', (evt) => {
        evt.preventDefault();

        const dbSearchTerm = $('#db_search_term').val();

        $.get(`/db_food_search/${dbSearchTerm}`, (res) => {
            
            const foods = res["foods"]
            const container = $('#display-db-search');
            container.empty()

            ;debugger

            if (foods.length === 0) {
                container.append('<br><i>No foods found</i>');
            }

            else {

                container.append('<ul>');

                for (const food of foods) {
                    container.append(`<div>
                        <p>Foods from demo database search:</p>
                        <li>${food.food} (${food.brand})
                        </li></div>`
                    );

                container.append('</ul');
                };
            }

        });
      });

    // Get intial foods when page initially loads!
    getFoodData();
    </script>

{% endblock %}